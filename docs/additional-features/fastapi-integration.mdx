---
title: "FastAPI Integration"
description: "Serve your agencies through FastAPI using factory functions."
icon: "server"
---

Use `run_fastapi` to expose your agencies as REST endpoints. The function accepts
a dictionary mapping URL-friendly names to *factory callables* that construct a
fresh `Agency` instance for each request. The mapping keys become part of the
endpoint path, so `{"company": create_agency}` results in `/company/get_completion`.
Each factory should accept an optional `load_threads_callback` argument used to
restore conversation history per request.

```python
# agency.py
from agency_swarm import Agent, Agency

# create your agents here

def create_agency(load_threads_callback=None) -> Agency:
    ceo = Agent(name="CEO", instructions="Lead the team")
    dev = Agent(name="Developer", instructions="Write code")
    return Agency(
        ceo,
        dev,
        communication_flows=[(ceo, dev)],
        load_threads_callback=load_threads_callback,
    )
```

```python
# main.py
from agency_swarm.integrations.fastapi import run_fastapi
from agency import create_agency

if __name__ == "__main__":
    run_fastapi({"company": create_agency})
```

If you manage multiple agency types, create a factory that selects by name:

```python
# agency.py
def make_agency(name: str) -> Agency:
    if name == "company":
        return create_agency()
    raise ValueError("Unknown agency")

# main.py
from agency_swarm.integrations.fastapi import run_fastapi
from agency import make_agency

run_fastapi({"company": lambda: make_agency("company")})
```

Each request initializes a fresh agency using your factory. Endpoints are created at `/company/get_completion` and `/company/get_completion_stream`.
Provide the previous conversation history in the `chat_history` field of each request. Both endpoints return the updated history so you can persist it and send it back next time. For streaming requests the history is sent as the final event.

Set an environment variable `APP_TOKEN` for basic bearer token authentication or override `app_token_env`.

You can also include tools:

```python
from mytools import MyTool
run_fastapi({"company": create_agency}, tools=[MyTool])
```

```python
import requests

history = {}
payload = {"message": "Hello", "chat_history": history}
resp = requests.post("http://127.0.0.1:8000/company/get_completion", json=payload)
history = resp.json()["chat_history"]
```

Use `Agency.run_fastapi()` for quick testing when serving a single instance.
